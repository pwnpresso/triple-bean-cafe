<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Triple Bean Cafe Â· Menu</title>
  <meta name="description" content="House beverage menu for Triple Bean Cafe." />
  <meta name="theme-color" content="#5b4636" />
  <link rel="icon" href="images/favicon.svg">
  <link rel="preload" href="images/logo.svg" as="image" type="image/svg+xml">
  <link rel="stylesheet" href="styles.css">
  <script src="https://unpkg.com/framer-motion@10/dist/framer-motion.js"></script>
</head>
<body class="loading">

  <!-- Loading screen -->
  <div class="loading-screen" id="loadingScreen">
    <div class="loading-logo">
      <img src="images/logo.svg" alt="Triple Bean Cafe">
    </div>
    <div class="loading-text">Triple Bean Cafe</div>
  </div>

  <div class="container" id="mainContainer">
    <header id="header">
      <div class="brand" id="brand">
        <img class="logo floating-logo" src="images/logo.svg" alt="Triple Bean Cafe logo" id="mainLogo">
        <h1 id="brandTitle">Triple Bean Cafe</h1>
      </div>
      <p class="tagline" id="tagline">
        <span class="tagline-line">â˜•ðŸŒ¿ Welcome to Triple Bean CafÃ© â€” a cosy corner for coffee, calm, and conversation.</span><br><br>
        <span class="tagline-line">We brew with care, take pride in slow mornings, and believe good coffee should feel like a small luxury.</span><br><br>
        <span class="tagline-line">âœ¨ Sit. Stay. Sip.<br>Your seat is always waiting.</span>
      </p>
    </header>

    <main class="menu" aria-label="Menu" id="menu">
      <div class="menu-header" id="menuHeader">
        <h2 id="menuTitle">Beverages</h2>
        <p class="note" id="menuNote">Ice available upon request â€¢ No decaf</p>
      </div>
      <div class="divider animate-divider" role="separator" aria-hidden="true" id="divider1"></div>

      <div class="sections" id="menuSections">
        <!-- Coffee -->
        <section class="section" aria-labelledby="coffee-title">
          <h3 id="coffee-title">Coffee</h3>
          <ul class="menu-list">
            <li class="card orderable" data-item="Iced Black">
              <div class="icon" data-badge="â„ï¸"><img src="images/iced-black.svg" alt="" width="32" height="32"></div>
              <div><div class="name">Iced Black</div><div class="meta">Tap to add</div></div>
              <div class="qty" data-qty="Iced Black"><button type="button" data-action="dec">âˆ’</button><span class="count">0</span><button type="button" data-action="inc">+</button></div>
            </li>
            <li class="card orderable" data-item="Hot Black">
              <div class="icon" data-badge="ðŸ”¥"><img src="images/hot-black.svg" alt="" width="32" height="32"></div>
              <div><div class="name">Hot Black</div><div class="meta">Tap to add</div></div>
              <div class="qty" data-qty="Hot Black"><button type="button" data-action="dec">âˆ’</button><span class="count">0</span><button type="button" data-action="inc">+</button></div>
            </li>
            <li class="card orderable" data-item="Iced White">
              <div class="icon" data-badge="â„ï¸"><img src="images/iced-white.svg" alt="" width="32" height="32"></div>
              <div><div class="name">Iced White</div><div class="meta">Tap to add</div></div>
              <div class="qty" data-qty="Iced White"><button type="button" data-action="dec">âˆ’</button><span class="count">0</span><button type="button" data-action="inc">+</button></div>
            </li>
            <li class="card orderable" data-item="Hot White">
              <div class="icon" data-badge="ðŸ”¥"><img src="images/hot-white.svg" alt="" width="32" height="32"></div>
              <div><div class="name">Hot White</div><div class="meta">Tap to add</div></div>
              <div class="qty" data-qty="Hot White"><button type="button" data-action="dec">âˆ’</button><span class="count">0</span><button type="button" data-action="inc">+</button></div>
            </li>
            <li class="card orderable" data-item="Aerocano">
              <div class="icon" data-badge="â„ï¸"><img src="images/aerocano.svg" alt="" width="32" height="32"></div>
              <div><div class="name">Aerocano</div><div class="meta">Aerated espresso on ice â€¢ Tap to add</div></div>
              <div class="qty" data-qty="Aerocano"><button type="button" data-action="dec">âˆ’</button><span class="count">0</span><button type="button" data-action="inc">+</button></div>
            </li>
            <li class="card orderable" data-item="Affogato">
              <div class="icon" data-badge="â„ï¸"><img src="images/affogato.svg" alt="" width="32" height="32"></div>
              <div><div class="name">Affogato</div><div class="meta">Vanilla ice cream + double espresso â€¢ Tap to add</div></div>
              <div class="qty" data-qty="Affogato"><button type="button" data-action="dec">âˆ’</button><span class="count">0</span><button type="button" data-action="inc">+</button></div>
            </li>
          </ul>
        </section>

        <!-- Tea -->
        <section class="section" aria-labelledby="tea-title">
          <h3 id="tea-title">Tea</h3>
          <ul class="menu-list">
            <li class="card orderable" data-item="Iced Matcha Latte">
              <div class="icon" data-badge="â„ï¸"><img src="images/iced-matcha.svg" alt="" width="32" height="32"></div>
              <div><div class="name">Iced Matcha Latte</div><div class="meta">Tap to add</div></div>
              <div class="qty" data-qty="Iced Matcha Latte"><button type="button" data-action="dec">âˆ’</button><span class="count">0</span><button type="button" data-action="inc">+</button></div>
            </li>
            <li class="card orderable" data-item="Hot Matcha Latte">
              <div class="icon" data-badge="ðŸ”¥"><img src="images/hot-matcha.svg" alt="" width="32" height="32"></div>
              <div><div class="name">Hot Matcha Latte</div><div class="meta">Tap to add</div></div>
              <div class="qty" data-qty="Hot Matcha Latte"><button type="button" data-action="dec">âˆ’</button><span class="count">0</span><button type="button" data-action="inc">+</button></div>
            </li>
            <li class="card orderable" data-item="Iced Strawberry Matcha Latte">
              <div class="icon" data-badge="â„ï¸"><img src="images/strawberry-matcha.svg" alt="" width="32" height="32"></div>
              <div><div class="name">Matcha Ichigo</div><div class="meta">Strawberry puree + matcha + milk â€¢ Tap to add</div></div>
              <div class="qty" data-qty="Iced Strawberry Matcha Latte"><button type="button" data-action="dec">âˆ’</button><span class="count">0</span><button type="button" data-action="inc">+</button></div>
            </li>
          </ul>
        </section>

        <!-- Misc -->
        <section class="section" aria-labelledby="misc-title">
          <h3 id="misc-title">Misc</h3>
          <ul class="menu-list">
            <li class="card">
              <div class="icon"><img src="images/fridge.svg" alt="" width="32" height="32"></div>
              <div><div class="name">Assorted Drinks in Fridge</div><div class="meta">Self-serve â€” help yourself from the fridge</div></div>
            </li>
            <li class="card orderable" data-item="Gin & Tonic">
              <div class="icon" data-badge="â„ï¸"><img src="images/gin-tonic.svg" alt="" width="32" height="32"></div>
              <div><div class="name">Gin &amp; Tonic</div><div class="meta">Tap to add</div></div>
              <div class="qty" data-qty="Gin & Tonic"><button type="button" data-action="dec">âˆ’</button><span class="count">0</span><button type="button" data-action="inc">+</button></div>
            </li>
          </ul>
        </section>
      </div>

      <div class="divider" role="separator" aria-hidden="true"></div>

      <div class="footer-bar">
        <div class="order-inputs">
          <input id="guestName" class="input" placeholder="Your name (optional)" autocomplete="name">
          <input id="note" class="input" placeholder="Note (optional): e.g., less ice / oat milk">
        </div>
        <div class="order-actions">
          <button id="sendBtn" class="button primary" type="button">Send Order</button>
          <div id="closedMsg" class="closed" style="display:none;" role="alert">Ordering is currently closed.</div>
        </div>
      </div>
      <div id="status" class="status" role="status" aria-live="polite"></div>

      <footer>Â© <span id="year"></span> Triple Bean Cafe Â· Handmade at home</footer>
    </main>
  </div>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    // >>> REPLACE with your current /exec URL (keep it exactly as in your working version)
    const ORDER_ENDPOINT = "https://script.google.com/macros/s/AKfycbykR7MxOkPuKtz7Sa92HJG9W1qOecMrydAf7LPQBYL2wpA1ULcj97WAfcBWZW29CdmJ/exec";

    // Animation Framework
    const { motion, animate, stagger } = Motion;

    // Premium Entrance Animation Sequence
    async function initPageAnimations() {
      const loadingScreen = document.getElementById('loadingScreen');
      const mainContainer = document.getElementById('mainContainer');

      // Wait for content to load
      await new Promise(resolve => setTimeout(resolve, 2000));

      // Hide loading screen with elegant transition
      loadingScreen.classList.add('fade-out');
      document.body.classList.remove('loading');

      // Show main container
      mainContainer.style.opacity = '1';

      setTimeout(() => {
        loadingScreen.style.display = 'none';
      }, 800);

      // Check if Motion is available, if not just show content
      if (typeof Motion === 'undefined' || !Motion.animate) {
        console.log('Motion not available, showing content directly');
        // Ensure everything is visible if animations can't run
        const elements = document.querySelectorAll('#brand, #brandTitle, .tagline-line, .card, .menu, .section');
        elements.forEach(el => el.style.opacity = '1');
        return;
      }

      // Add animation-ready class for elements that should animate
      document.body.classList.add('animate-ready');

      // Animate main content entrance
      setTimeout(async () => {
        try {
          // Header animation sequence
          await animate('#brand',
            { opacity: [0, 1], y: [-30, 0], scale: [0.8, 1] },
            { duration: 0.8, ease: [0.68, -0.55, 0.265, 1.55] }
          );

          await animate('#brandTitle',
            { opacity: [0, 1], x: [-20, 0] },
            { duration: 0.6, delay: 0.2 }
          );

          // Tagline staggered animation
          const taglineLines = document.querySelectorAll('.tagline-line');
          await animate(taglineLines,
            { opacity: [0, 1], y: [20, 0] },
            { duration: 0.5, delay: stagger(0.2) }
          );

          // Menu entrance
          await animate('#menu',
            { opacity: [0, 1], y: [40, 0], scale: [0.95, 1] },
            { duration: 0.8, delay: 0.3 }
          );

          // Menu sections staggered entrance
          const sections = document.querySelectorAll('.section');
          await animate(sections,
            { opacity: [0, 1], y: [30, 0], rotateX: [10, 0] },
            { duration: 0.6, delay: stagger(0.15) }
          );

          // Cards individual animation
          const cards = document.querySelectorAll('.card');
          animate(cards,
            { opacity: [0, 1], x: [-20, 0] },
            { duration: 0.4, delay: stagger(0.05) }
          );
        } catch (error) {
          console.log('Animation error:', error);
        }
      }, 500);
    }

    // Enhanced Interaction Animations
    function setupInteractionAnimations() {
      // Card hover enhancements
      const orderableCards = document.querySelectorAll('.card.orderable');
      const sections = document.querySelectorAll('.section');

      // Enhanced touch/hover for cards
      orderableCards.forEach(card => {
        const icon = card.querySelector('.icon');

        // Mouse events (desktop)
        card.addEventListener('mouseenter', () => {
          if (typeof Motion !== 'undefined' && Motion.animate && icon) {
            animate(icon,
              { scale: [1, 1.1], rotate: [0, 5] },
              { duration: 0.3 }
            );
          }
        });

        card.addEventListener('mouseleave', () => {
          if (typeof Motion !== 'undefined' && Motion.animate && icon) {
            animate(icon,
              { scale: [1.1, 1], rotate: [5, 0] },
              { duration: 0.3 }
            );
          }
        });

        // Touch events (mobile)
        card.addEventListener('touchstart', (e) => {
          card.classList.add('touch-active');
          if (typeof Motion !== 'undefined' && Motion.animate && icon) {
            animate(icon,
              { scale: [1, 1.1], rotate: [0, 5] },
              { duration: 0.3 }
            );
          }
        });

        card.addEventListener('touchend', () => {
          setTimeout(() => {
            card.classList.remove('touch-active');
            if (typeof Motion !== 'undefined' && Motion.animate && icon) {
              animate(icon,
                { scale: [1.1, 1], rotate: [5, 0] },
                { duration: 0.3 }
              );
            }
          }, 150); // Brief delay for visual feedback
        });

        card.addEventListener('touchcancel', () => {
          card.classList.remove('touch-active');
          if (typeof Motion !== 'undefined' && Motion.animate && icon) {
            animate(icon,
              { scale: [1.1, 1], rotate: [5, 0] },
              { duration: 0.3 }
            );
          }
        });
      });

      // Section touch animations
      sections.forEach(section => {
        section.addEventListener('touchstart', () => {
          section.classList.add('touch-active');
        });

        section.addEventListener('touchend', () => {
          setTimeout(() => {
            section.classList.remove('touch-active');
          }, 200);
        });

        section.addEventListener('touchcancel', () => {
          section.classList.remove('touch-active');
        });
      });

      // Button press animations
      const buttons = document.querySelectorAll('.qty button, .button');
      buttons.forEach(button => {
        // Click animation (both mouse and touch)
        button.addEventListener('click', () => {
          if (typeof Motion !== 'undefined' && Motion.animate) {
            animate(button,
              { scale: [1, 0.9, 1.1, 1] },
              { duration: 0.4, ease: [0.68, -0.55, 0.265, 1.55] }
            );
          }
        });

        // Enhanced touch feedback
        button.addEventListener('touchstart', (e) => {
          // Only prevent default for non-functional buttons to avoid blocking clicks
          // Don't prevent default for any functional buttons (.qty button or #sendBtn)
          if (!button.matches('.qty button') && !button.matches('#sendBtn')) {
            e.preventDefault(); // Prevent double-tap zoom
          }
          button.style.transform = 'scale(0.95)';
          button.style.transition = 'transform 0.1s ease';
        });

        button.addEventListener('touchend', () => {
          button.style.transform = 'scale(1)';
          setTimeout(() => {
            button.style.transition = '';
          }, 100);
        });

        button.addEventListener('touchcancel', () => {
          button.style.transform = 'scale(1)';
          button.style.transition = '';
        });
      });
    }

    // Initialize everything when DOM loads
    document.addEventListener('DOMContentLoaded', () => {
      initPageAnimations();
      setupInteractionAnimations();
    });

    // === ORIGINAL FORM FUNCTIONALITY PRESERVED ===
    const counts = {};
    const cards = document.querySelectorAll('.card.orderable');
    cards.forEach(card => {
      const item = card.getAttribute('data-item');
      counts[item] = 0;

      // More robust card click handler that avoids button areas
      card.addEventListener('click', (e) => {
        // Check if click is on button or within .qty container
        if (e.target.closest('button') || e.target.closest('.qty')) {
          return; // Don't increment if clicking on buttons or quantity controls
        }
        inc(item);
      });

      const qty = card.querySelector('.qty');
      qty.querySelector('[data-action="inc"]').addEventListener('click', (e) => {
        e.stopPropagation();
        inc(item);
      });
      qty.querySelector('[data-action="dec"]').addEventListener('click', (e) => {
        e.stopPropagation();
        dec(item);
      });
    });
    function render(item) { const el = document.querySelector('.qty[data-qty="' + item.replace(/"/g, '&quot;') + '"] .count'); if (el) el.textContent = counts[item]; }
    function inc(item) { counts[item] = Math.min(99, (counts[item] || 0) + 1); render(item); }
    function dec(item) { counts[item] = Math.max(0, (counts[item] || 0) - 1); render(item); }

    const statusEl = document.getElementById('status');
    const sendBtn = document.getElementById('sendBtn');
    const closedMsg = document.getElementById('closedMsg');

    async function checkOpen() {
      try {
        const res = await fetch(ORDER_ENDPOINT, { method: 'GET', headers: { 'Accept': 'application/json' } });
        const data = await res.json();
        const open = !!(data && data.open);
        sendBtn.disabled = !open;
        closedMsg.style.display = open ? 'none' : '';
      }catch{ /* ignore */ }
    }
    checkOpen();

    if (sendBtn) {
      sendBtn.addEventListener('click', async (e) => {

      const items = Object.entries(counts).filter(([k, v]) => v > 0).map(([name, qty]) => ({ name, qty }));
      if (items.length === 0) {
        statusEl.textContent = "Add at least one item by tapping.";
        statusEl.style.display = "block"; // Ensure visibility
        return;
      }
      const payload = { from: (document.getElementById('guestName').value || '').trim(), note: (document.getElementById('note').value || '').trim(), items };
      statusEl.textContent = "Sendingâ€¦";
      statusEl.style.display = "block"; // Ensure visibility
      try {
        const res = await fetch(ORDER_ENDPOINT, { method: 'POST', headers: { 'Content-Type': 'text/plain;charset=utf-8' }, body: JSON.stringify(payload) });
        const data = await res.json().catch(() => ({}));
        if (data.ok) {
          statusEl.textContent = "Order sent! Thank you â˜•.";
          Object.keys(counts).forEach(k => { counts[k] = 0; render(k); });
          document.getElementById('guestName').value = ""; document.getElementById('note').value = "";
        } else if (data.error === "closed") {
          statusEl.textContent = "Ordering is closed.";
          sendBtn.disabled = true; closedMsg.style.display = '';
        } else {
          statusEl.textContent = "Failed to send.";
        }
      } catch { statusEl.textContent = "Network error."; }
      });
    }
  </script>
</body>
</html>